(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-30673bec"],{5860:function(e,t,s){"use strict";var i=s("689c"),n=s.n(i);n.a},"62d8":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"vueapp"}},[s("div",{staticStyle:{"text-align":"center"}},[s("h2",[e._v("视频录制建议使用Chrome浏览器")]),s("label",[e._v("Audio source: ")]),s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.audioChange},model:{value:e.audioValue,callback:function(t){e.audioValue=t},expression:"audioValue"}},e._l(e.audioOptions,(function(e){return s("el-option",{key:e.get("value"),attrs:{label:e.get("label"),value:e.get("value")}})})),1),s("label",[e._v("Video source: ")]),s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.videoChange},model:{value:e.videoValue,callback:function(t){e.videoValue=t},expression:"videoValue"}},e._l(e.videoOptions,(function(e){return s("el-option",{key:e.get("value"),attrs:{label:e.get("label"),value:e.get("value")}})})),1),s("video",{staticStyle:{clear:"both",display:"block",margin:"auto",width:"640px",height:"480px"},attrs:{id:"my-player",meted:"meted",autoplay:""}}),s("el-button",{attrs:{id:"rec",plain:!0,type:"success",disabled:e.recBtn},nativeOn:{click:function(t){return e.startRec(t)}}},[e._v("录制")]),s("el-button",{attrs:{id:"pauseRec",plain:!0,type:"warning",disabled:e.pauseResBtn},nativeOn:{click:function(t){return e.pauseRec(t)}}},[e._v(" "+e._s(e.pause?"继续":"暂停")+" ")]),s("el-button",{attrs:{id:"stopRec",plain:!0,type:"danger",disabled:e.stopBtn},nativeOn:{click:function(t){return e.stopRec(t)}}},[e._v("停止 ")]),s("el-button",{attrs:{id:"saveRec",plain:!0,type:"primary",disabled:e.saveBtn},nativeOn:{click:function(t){return e.saveVideo(t)}}},[e._v("保持本地视频 ")]),s("el-button",{attrs:{id:"getRec",plain:!0,type:"primary",disabled:e.getBtn},nativeOn:{click:function(t){return e.getVideo(t)}}},[e._v("获取远程文件 ")]),s("br"),s("br"),s("p",{attrs:{id:"data"}})],1)])},n=[],a=(s("4160"),s("ace4"),s("b0c0"),s("4ec9"),s("d3b7"),s("ac1f"),s("25f0"),s("3ca3"),s("5319"),s("5cc6"),s("9a8c"),s("a975"),s("735e"),s("c1ac"),s("d139"),s("3a7b"),s("d5d6"),s("82f8"),s("e91f"),s("60bd"),s("5f96"),s("3280"),s("3fcc"),s("ca91"),s("25a1"),s("cd26"),s("3c5d"),s("2954"),s("649e"),s("219c"),s("170b"),s("b39a"),s("72f7"),s("159b"),s("ddb0"),s("2b3d"),s("bc3a")),o=s.n(a),r={name:"HelloWorld",props:{msg:String},data:function(){return{dataElement:null,audioSelect:0,videoSelect:0,uid:this.generateUUID(),mr:null,chunks:[],url:"wss://matrix-video.siku.cn/ws",restUrl:"https://gw.siku.cn/video/getVideo?id=",ws:null,videoOptions:[],audioOptions:[],videoValue:"",audioValue:"",textarea:"",constraints:{audio:{echoCancellation:{exact:!0},deviceId:{exact:this.audioValue}},video:{width:{min:1280,max:1920},height:{min:720,max:1080},deviceId:{exact:this.videoValue}}},params:{id:Math.floor(1e7*Math.random())},recBtn:!1,pauseResBtn:!0,pause:!1,stopBtn:!0,openVideo:!1,getBtn:!0,saveBtn:!0,stream:null,ply:null,options:{},mediaOptions:{},videoElement:null,saveUrl:""}},mounted:function(){this.init(),this.openRec()},computed:{},methods:{saveVideo:function(){var e="video_"+this.params.id+".webm",t=document.createElement("a");t.href=this.saveUrl,t.download=e,t.click()},getVideo:function(){var e=this;o.a.get(this.restUrl+this.params.id).then((function(t){var s=t.data;""!=s?window.open(s,"_blank"):e.$message({showClose:!0,message:"视频正在处理中，请稍后。。。",type:"success"})}))},log:function(e){this.dataElement.innerHTML=this.dataElement.innerHTML+"<br>"+e},stopRecorder:function(){null!=this.mr&&(this.mr.stop(),this.mr=null)},error:function(e){this.log("访问用户媒体设备失败：",e.name,e.message)},closeStream:function(){null!=this.stream&&(this.stream.getTracks().forEach((function(e){return e.stop()})),this.stream=null),this.disconnect()},startRecording:function(){var e=this;this.log("Start recording..."),"function"==typeof MediaRecorder.isTypeSupported?(MediaRecorder.isTypeSupported("video/webm;codecs=vp9")||MediaRecorder.isTypeSupported("video/webm;codecs=h264")?this.mediaOptions={mimeType:"video/webm;codecs=h264"}:MediaRecorder.isTypeSupported("video/webm;codecs=vp8")&&(this.mediaOptions={mimeType:"video/webm;codecs=vp8"}),this.log("Using mimeType "+this.mediaOptions.mimeType),this.mr=new MediaRecorder(this.stream,this.mediaOptions)):(this.log("isTypeSupported is not supported, using default codecs for browser"),this.mr=new MediaRecorder(this.stream)),this.mr.start(100),this.mr.ondataavailable=function(t){e.chunks.push(t.data);var s=new FileReader;s.addEventListener("loadend",(function(){var t=new Uint8Array(s.result);s.result.byteLength>0&&e.send(t)})),s.readAsArrayBuffer(t.data)},this.mr.onerror=function(t){e.log("mediaRecorder Error: "+t),console.log("Error: ",t)},this.mr.onstart=function(){e.log("Started & state = "+e.mr.state)},this.mr.onstop=function(){var t=new Blob(e.chunks,{type:"video/webm"});e.chunks.length=0;var s=window.URL.createObjectURL(t);e.saveUrl=s,e.log("停止录制,关闭MediaStream")},this.mr.onpause=function(){e.log("Paused & state = "+e.mr.state)},this.mr.onresume=function(){e.log("Resumed  & state = "+e.mr.state)},this.mr.onwarning=function(t){e.log("Warning: "+t)}},handleError:function(e){console.log("Error: ",e)},gotDevices:function(e){var t=new Array,s=new Array;console.log(e);for(var i=0;i!==e.length;++i){var n=new Map,a=e[i];n.set("value",a.deviceId),"audioinput"===a.kind?(n.set("label",a.label||"microphone "+(this.audioSelect+1)),s.push(n)):"videoinput"===a.kind?(n.set("label",a.label||"microphone "+(this.videoSelect+1)),t.push(n)):this.log("Found one other kind of source/device: "+a.label)}this.audioOptions=s,this.videoOptions=t,this.audioValue=s[0].get("label"),this.videoValue=t[0].get("label"),this.constraints.audio.deviceId.exact=s[0].get("value"),this.constraints.video.deviceId.exact=t[0].get("value")},send:function(e){null!=this.ws&&1==this.ws.readyState&&this.ws.send(e)},disconnect:function(){try{null!=this.ws&&(this.ws.close(),this.ws=null,this.log("closed ws succ!")),console.log("Connection was closed successfully!")}catch(e){console.log("No connection, please start connect first.")}},stopVideo:function(){this.disconnect(),this.stopRecorder()},initParams:function(){},initBusinessParam:function(){var e=JSON.stringify({uid:this.uid,type:2,data:JSON.stringify(this.params)});this.send(e)},startConnect:function(){var e=this;null!=this.ws&&this.disconnect(),this.initParams(),this.initWs(),this.ws.onerror=function(){e.$confirm("数据传输出现问题 , 是否继续? 如继续录制视频将保存在本地，将不能自动上传服务器","提示",{confirmButtonText:"继续本地录制",cancelButtonText:"取消录制",type:"warning"}).then((function(){e.$message({type:"warning",message:"继续录制，录制完后请自行保存本地视频!"})})).catch((function(){e.stopRec(),e.$message({type:"warning",message:"已取消录制"})}))},this.ws.onclose=function(t){e.log("websocket channel close"+t)},this.ws.onopen=function(){e.log("websocket channel is open,url: "+this.url),e.initBusinessParam(),e.ws.onmessage=function(t){"message"===t.type&&e.log(t.data)},window.setInterval((function(){if(null!=e.ws){var t=JSON.stringify({uid:e.uid,type:0});e.send(t)}}),3e4)}},initWs:function(){this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer"},generateUUID:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:3&s|8).toString(16)}));return t},openRec:function(){var e=this;null==e.stream?(this.player(),this.$message({showClose:!0,message:"摄像头已开启",type:"success"})):this.$message({showClose:!0,message:"摄像头已开启",type:"success"})},pauseRec:function(){this.pause?(this.pause=!1,this.stopBtn=!1,this.log("继续录制"),this.mr.resume(),this.$message({showClose:!0,message:"继续录制",type:"success"})):(this.pause=!0,this.log("暂停录制"),this.mr.pause(),this.$message({showClose:!0,message:"暂停录制",type:"warning"})),this.recBtn=!0,this.pauseResBtn=!1},stopRec:function(){this.stopVideo(),this.saveBtn=!1,this.getBtn=!1,this.recBtn=!1,this.pauseResBtn=!0,this.stopBtn=!0,this.$message({showClose:!0,message:"停止录制",type:"warning"})},startRec:function(){this.dataElement.innerHTML="startRec...",this.openRec(),this.saveBtn=!0,this.getBtn=!0,this.recBtn=!0,this.pauseResBtn=!1,this.stopBtn=!1,this.startConnect(),this.startRecording(),this.$message({showClose:!0,message:"开始录制",type:"success"})},player:function(){var e=this;navigator.mediaDevices.getUserMedia(e.constraints).then((function(t){e.stream=t;var s=document.querySelector("video");s.srcObject=t,s.play(),e.ply=s}))},reOpenPlayer:function(){this.closeStream(),this.stopRecorder(),this.openRec()},audioChange:function(e){var t=this;this.audioValue=e,t.constraints.audio.deviceId.exact=e,this.reOpenPlayer(),this.$message({showClose:!0,message:"切换音频成功，id: "+e,type:"success"})},videoChange:function(e){var t=this;this.videoValue=e,t.constraints.video.deviceId.exact=e,this.reOpenPlayer(),this.$message({showClose:!0,message:"切换视频成功，id: "+e,type:"success"})},init:function(){var e=this;try{this.dataElement=document.querySelector("#data"),this.videoElement=document.querySelector("video"),navigator.mediaDevices.getUserMedia(this.constraints).then((function(t){null!=t&&t.getTracks().forEach((function(e){return e.stop()})),navigator.mediaDevices.enumerateDevices().then(e.gotDevices)}))}catch(t){console.error("navigator.getUserMedia error:",t),this.log("navigator.getUserMedia error:".concat(t.toString()))}}}},c=r,l=(s("5860"),s("0c7c")),u=Object(l["a"])(c,i,n,!1,null,null,null);t["default"]=u.exports},"689c":function(e,t,s){}}]);